<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Natal Gekisia Kaur 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;800&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .font-elegant { font-family: 'Playfair Display', serif; }
        
        /* Animasi */
        @keyframes snowfall { 0% { transform: translateY(-10px); opacity: 0; } 50% { opacity: 1; } 100% { transform: translateY(100px); opacity: 0; } }
        .animate-snow { animation: snowfall 4s linear infinite; }
        .christmas-lights { display: flex; justify-content: center; gap: 8px; padding-top: 5px; position: absolute; top: 0; width: 100%; z-index: 20; }
        .light { width: 8px; height: 8px; border-radius: 50%; animation: twinkle 1s infinite alternate; }
        @keyframes twinkle { 0% { opacity: 0.4; } 100% { opacity: 1; box-shadow: 0 0 10px currentColor; } }

        /* Tombol Micro */
        .control-btn { background: rgba(255, 255, 255, 0.08); border: 1px solid rgba(255, 255, 255, 0.2); color: #ccc; padding: 5px 0; text-align: center; border-radius: 4px; font-weight: 600; font-size: 9px; text-transform: uppercase; letter-spacing: 0.5px; transition: all 0.1s; }
        .control-btn:active { background: rgba(255, 255, 255, 0.3); color: white; transform: scale(0.96); }

        /* Loader */
        .loader { border: 2px solid rgba(255,255,255,0.1); border-top: 2px solid #fbbf24; border-radius: 50%; width: 24px; height: 24px; animation: spin 0.6s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="text-gray-800 pb-10 select-none bg-gray-50">

    <header class="fixed top-0 left-0 w-full bg-red-900 text-white shadow-xl z-40 border-b-4 border-yellow-600">
        <div class="christmas-lights"><div class="light bg-red-500"></div><div class="light bg-yellow-400"></div><div class="light bg-green-500"></div><div class="light bg-blue-400"></div></div>
        <div class="absolute inset-0 pointer-events-none opacity-20"><div class="absolute top-0 left-[10%] animate-snow text-lg" style="animation-duration: 5s;">‚ùÑÔ∏è</div></div>
        <div class="max-w-5xl mx-auto px-4 pt-7 pb-3 text-center relative z-10">
            <div class="flex items-center justify-center gap-2 mb-1">
                <span class="text-lg filter drop-shadow-md">üéÑ</span>
                <h1 class="text-lg md:text-xl font-bold font-elegant tracking-wider text-yellow-100 drop-shadow-md">Natal Gekisia Kaur</h1>
                <span class="text-lg filter drop-shadow-md">üéÑ</span>
            </div>
            <p class="text-[8px] text-red-200 uppercase tracking-[0.2em] font-serif mt-0.5 border-t border-red-700 inline-block px-4 pt-1">Tim Dokumentasi 2025</p>
            
            <div id="filter-container" class="flex justify-center gap-3 mt-3">
                <button onclick="changeFilter('image')" id="btn-foto" class="px-4 py-1.5 rounded-sm text-[9px] font-bold tracking-widest uppercase transition border border-white bg-white text-red-900 shadow-sm">FOTO</button>
                <button onclick="changeFilter('video')" id="btn-video" class="px-4 py-1.5 rounded-sm text-[9px] font-bold tracking-widest uppercase transition border border-red-800 bg-red-950 text-red-300">VIDEO</button>
            </div>
        </div>
    </header>
    <div class="h-[140px]"></div>

    <div id="view-gallery">
        <main class="max-w-6xl mx-auto px-2 md:px-6 min-h-screen">
            <div id="skeleton-loader" class="grid grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-1.5 md:gap-4">
                <div class="bg-gray-300 h-28 rounded animate-pulse"></div><div class="bg-gray-300 h-28 rounded animate-pulse"></div>
                <div class="bg-gray-300 h-28 rounded animate-pulse"></div><div class="bg-gray-300 h-28 rounded animate-pulse"></div>
                <div class="bg-gray-300 h-28 rounded animate-pulse"></div><div class="bg-gray-300 h-28 rounded animate-pulse"></div>
            </div>
            <div id="gallery-container" class="grid grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-1.5 md:gap-4 hidden"></div>
            <div id="empty-state" class="hidden flex flex-col items-center justify-center py-20 opacity-60">
                <p class="text-gray-500 font-elegant italic text-xs">Tidak ada dokumentasi.</p>
            </div>
        </main>
    </div>

    <div id="view-admin" class="hidden min-h-screen flex items-center justify-center p-4">
        <div class="bg-white p-6 rounded-lg shadow-2xl w-full max-w-sm border border-gray-200 relative z-50 mt-20">
            <h2 class="text-xl font-bold text-center text-red-900 mb-4 font-elegant">Input Video Baru</h2>
            <form id="videoForm" class="flex flex-col gap-3">
                <div>
                    <label class="block text-[10px] uppercase font-bold text-gray-500">Judul Video</label>
                    <input type="text" id="inpTitle" class="w-full bg-gray-50 border border-gray-300 rounded p-2 text-sm" placeholder="Contoh: Vokal Grup">
                </div>
                <div>
                    <label class="block text-[10px] uppercase font-bold text-gray-500">ID YouTube</label>
                    <input type="text" id="inpYt" class="w-full bg-gray-50 border border-gray-300 rounded p-2 text-sm" placeholder="Contoh: dQw4w9WgXcQ">
                </div>
                <div>
                    <label class="block text-[10px] uppercase font-bold text-gray-500">ID Drive (File Asli)</label>
                    <input type="text" id="inpDr" class="w-full bg-gray-50 border border-gray-300 rounded p-2 text-sm" placeholder="ID File Google Drive">
                </div>
                <button type="submit" id="submitBtn" class="mt-2 bg-red-900 text-white font-bold py-3 rounded text-sm hover:bg-red-800 transition">SIMPAN DATA</button>
                <p id="adminStatus" class="text-center text-xs mt-2 h-4"></p>
                <a href="/" class="text-center text-[10px] text-gray-400 mt-2 underline">Kembali ke Galeri</a>
            </form>
        </div>
    </div>

    <footer class="text-center py-8 text-gray-400 text-[9px] pb-20 font-serif"><p>Gekisia Kaur ¬© 2025</p></footer>

    <div id="lightbox" class="fixed inset-0 z-[100] bg-black hidden flex flex-col backdrop-blur-sm transition-opacity duration-200">
        <div id="zoom-area" class="flex-1 relative w-full bg-black/95 flex items-center justify-center overflow-hidden">
            <div id="lb-spinner" class="absolute inset-0 flex items-center justify-center pointer-events-none z-50"><div class="flex flex-col items-center gap-2"><div class="loader"></div><span class="text-white text-[8px] tracking-widest opacity-70">HD...</span></div></div>
            <img id="lb-img" src="" class="transition-transform duration-200 opacity-0" style="max-height: 85vh; max-width: 100%; object-fit: contain;" alt="Preview">
            <iframe id="lb-video" src="" class="hidden w-full max-w-4xl aspect-video rounded shadow-2xl bg-black" allow="autoplay; fullscreen" frameborder="0"></iframe>
        </div>
        <div class="bg-[#111] border-t border-gray-800 p-2 pb-5 z-50 shadow-2xl">
            <div class="max-w-[240px] mx-auto flex flex-col gap-1.5">
                <div id="zoom-controls" class="grid grid-cols-2 gap-1.5"><button onclick="adjustZoom(-0.5)" class="control-btn bg-gray-800">Perkecil</button><button onclick="adjustZoom(0.5)" class="control-btn bg-gray-800">Perbesar</button></div>
                <div class="grid grid-cols-2 gap-1.5"><button onclick="navigate(-1)" class="control-btn bg-gray-800">&lt; Geser</button><button onclick="navigate(1)" class="control-btn bg-gray-800">Geser &gt;</button></div>
                <p id="lb-title" class="text-gray-500 text-[9px] text-center py-0.5 truncate font-sans tracking-wide">...</p>
                <a id="lb-download-btn" href="#" target="_blank" class="block w-full text-center bg-green-700 text-white font-bold py-2 rounded-[3px] text-[10px] uppercase tracking-wider shadow-lg border-t border-green-500">Simpan ke HP</a>
                <button onclick="closeLightbox()" class="w-full bg-gray-800 active:bg-gray-700 text-gray-400 font-semibold py-2 rounded-[3px] text-[10px] uppercase tracking-wider border border-gray-700">Tutup</button>
            </div>
        </div>
    </div>
    <div id="toast" class="fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-black/90 text-white px-4 py-3 rounded-lg shadow-2xl z-[200] hidden flex flex-col items-center gap-2 text-xs border border-gray-600"><span class="loader w-4 h-4 border-2"></span><span class="text-[10px] uppercase tracking-wide">Menyimpan...</span></div>

    <script>
        // ==========================================
        // ‚ö†Ô∏è PASTE URL SCRIPT ANDA DI SINI ‚ö†Ô∏è
        // ==========================================
        const scriptURL = "https://script.google.com/macros/s/AKfycbyjidyc8J9n7VFLLDPWpVHsCNkdC5UhzO5gdNw0UHI1WQ4td38n6DUQ7q_Z1xd13_aq/exec"; 

        let allData = { images: [], videos: [] };
        let filteredData = [];
        let currentIndex = 0; let currentFilter = 'image'; let currentZoom = 1;

        // Mode Check
        const urlParams = new URLSearchParams(window.location.search);
        const isAdmin = urlParams.get('mode') === 'admin';
        
        const viewGallery = document.getElementById('view-gallery');
        const viewAdmin = document.getElementById('view-admin');
        const filterContainer = document.getElementById('filter-container');

        if(isAdmin) {
            viewGallery.classList.add('hidden'); viewAdmin.classList.remove('hidden'); filterContainer.classList.add('hidden');
        } else {
            viewGallery.classList.remove('hidden'); viewAdmin.classList.add('hidden'); filterContainer.classList.remove('hidden');
            loadData();
        }

        // --- ADMIN SUBMIT ---
        document.getElementById('videoForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const btn = document.getElementById('submitBtn');
            const status = document.getElementById('adminStatus');
            btn.textContent = "Menyimpan..."; btn.disabled = true;
            
            const title = document.getElementById('inpTitle').value;
            const yt = document.getElementById('inpYt').value;
            const dr = document.getElementById('inpDr').value;

            fetch(`${scriptURL}?action=add&title=${encodeURIComponent(title)}&yt=${encodeURIComponent(yt)}&dr=${encodeURIComponent(dr)}`)
            .then(res => {
                status.textContent = "‚úÖ Sukses!"; status.className = "text-center text-xs mt-2 text-green-600 font-bold";
                document.getElementById('videoForm').reset();
                setTimeout(() => { btn.textContent = "SIMPAN DATA"; btn.disabled = false; status.textContent = ""; }, 2000);
            }).catch(err => { status.textContent = "‚ùå Gagal."; btn.disabled = false; });
        });

        // --- GALERI LOGIC ---
        function loadData() {
            const container = document.getElementById('gallery-container');
            const skeleton = document.getElementById('skeleton-loader');
            fetch(scriptURL + "?action=read").then(res => res.json()).then(data => {
                allData = data; skeleton.classList.add('hidden'); container.classList.remove('hidden'); changeFilter('image');
            }).catch(err => { skeleton.innerHTML = "<p class='col-span-full text-center text-red-500 text-xs'>Gagal memuat.</p>"; });
        }

        function changeFilter(type) {
            currentFilter = type;
            const btnFoto = document.getElementById('btn-foto');
            const btnVideo = document.getElementById('btn-video');
            const emptyState = document.getElementById('empty-state');
            
            if(type === 'image') {
                btnFoto.className = "px-4 py-1.5 rounded-sm text-[9px] font-bold tracking-widest uppercase transition border border-white bg-white text-red-900 shadow-sm transform scale-105";
                btnVideo.className = "px-4 py-1.5 rounded-sm text-[9px] font-bold tracking-widest uppercase transition border border-red-800 bg-red-950 text-red-300 opacity-60 hover:opacity-100";
                filteredData = allData.images || [];
            } else {
                btnVideo.className = "px-4 py-1.5 rounded-sm text-[9px] font-bold tracking-widest uppercase transition border border-white bg-white text-red-900 shadow-sm transform scale-105";
                btnFoto.className = "px-4 py-1.5 rounded-sm text-[9px] font-bold tracking-widest uppercase transition border border-red-800 bg-red-950 text-red-300 opacity-60 hover:opacity-100";
                filteredData = allData.videos || [];
            }

            const container = document.getElementById('gallery-container'); container.innerHTML = '';
            if (filteredData.length === 0) { emptyState.classList.remove('hidden'); return; } else { emptyState.classList.add('hidden'); }

            filteredData.forEach((item, index) => {
                const isVideo = currentFilter === 'video';
                let thumbUrl = isVideo ? `https://img.youtube.com/vi/${item.youtubeId}/hqdefault.jpg` : `https://drive.google.com/thumbnail?id=${item.driveId}&sz=w400`;
                const card = document.createElement('div');
                card.className = "bg-white rounded shadow-sm overflow-hidden active:scale-95 transition-transform duration-100 relative border border-gray-100 cursor-pointer";
                card.onclick = () => openLightbox(index);
                card.innerHTML = `<div class="aspect-square bg-gray-200 relative flex items-center justify-center overflow-hidden"><img src="${thumbUrl}" alt="Img" class="w-full h-full object-cover relative z-10 transition-opacity duration-300 opacity-0" loading="lazy" onload="this.classList.remove('opacity-0')">${isVideo ? '<div class="absolute inset-0 flex items-center justify-center bg-black/40 z-20"><div class="w-8 h-8 bg-red-600 rounded-full flex items-center justify-center shadow-lg"><span class="text-white text-xs">‚ñ∂</span></div></div>' : ''}</div>`;
                if(isVideo) card.innerHTML += `<div class="p-2 bg-white text-center"><p class="text-[9px] font-serif uppercase tracking-wider text-gray-700 truncate">${item.title}</p></div>`;
                container.appendChild(card);
            });
        }

        // --- LIGHTBOX ---
        const lightbox = document.getElementById('lightbox'); const lbImg = document.getElementById('lb-img'); const lbVideo = document.getElementById('lb-video'); const lbSpinner = document.getElementById('lb-spinner'); const lbTitle = document.getElementById('lb-title'); const lbBtn = document.getElementById('lb-download-btn'); const zoomControls = document.getElementById('zoom-controls'); const zoomArea = document.getElementById('zoom-area');

        function openLightbox(index) { currentIndex = index; currentZoom = 1; lightbox.classList.remove('hidden'); document.body.style.overflow = 'hidden'; updateContent(); }
        
        function updateContent() {
            const item = filteredData[currentIndex]; const isVideo = currentFilter === 'video';
            lbTitle.innerText = item.title.replace(/\.[^/.]+$/, "");
            currentZoom = 1; lbImg.style.transform = `scale(1)`; zoomArea.style.overflow = 'hidden';

            if (isVideo) {
                lbImg.classList.add('hidden'); lbSpinner.classList.add('hidden'); lbVideo.classList.remove('hidden'); zoomControls.classList.add('hidden');
                lbVideo.src = `https://www.youtube.com/embed/${item.youtubeId}?autoplay=1&rel=0`;
                lbBtn.innerHTML = "Download File (Drive)"; lbBtn.href = `https://drive.google.com/uc?export=download&id=${item.driveId}`; lbBtn.onclick = null;
                lbBtn.className = "block w-full text-center bg-blue-700 text-white font-bold py-2 rounded-[3px] text-[10px] uppercase tracking-wider shadow-lg border-t border-blue-500";
            } else {
                lbVideo.classList.add('hidden'); lbVideo.src = ""; zoomControls.classList.remove('hidden');
                lbImg.classList.add('opacity-0'); lbImg.classList.remove('hidden'); lbSpinner.classList.remove('hidden');
                const hdUrl = `https://drive.google.com/thumbnail?id=${item.driveId}&sz=w2500`; lbImg.src = hdUrl;
                lbImg.onload = () => { lbSpinner.classList.add('hidden'); lbImg.classList.remove('opacity-0'); };
                lbBtn.innerHTML = "Simpan ke HP"; lbBtn.href = "#";
                lbBtn.className = "block w-full text-center bg-green-700 text-white font-bold py-2 rounded-[3px] text-[10px] uppercase tracking-wider shadow-lg border-t border-green-500";
                lbBtn.onclick = (e) => { e.preventDefault(); forceDownloadImage(item.driveId, item.title); };
            }
        }

        function adjustZoom(delta) { if (currentFilter === 'video') return; currentZoom += delta; if (currentZoom < 1) currentZoom = 1; if (currentZoom > 4) currentZoom = 4; lbImg.style.transform = `scale(${currentZoom})`; if (currentZoom > 1) { zoomArea.style.overflow = 'auto'; lbImg.style.cursor = 'grab'; } else { zoomArea.style.overflow = 'hidden'; lbImg.style.cursor = 'default'; } }
        function navigate(direction) { let newIndex = currentIndex + direction; if (newIndex >= filteredData.length) newIndex = 0; if (newIndex < 0) newIndex = filteredData.length - 1; currentIndex = newIndex; updateContent(); }
        function forceDownloadImage(driveId, fileName) { const toast = document.getElementById('toast'); toast.classList.remove('hidden'); const fastUrl = `https://wsrv.nl/?url=https://drive.google.com/uc?id=${driveId}&w=2500&q=95&output=jpg`; fetch(fastUrl).then(res => res.blob()).then(blob => { const blobUrl = window.URL.createObjectURL(blob); const link = document.createElement('a'); link.href = blobUrl; link.download = fileName + ".jpg"; document.body.appendChild(link); link.click(); document.body.removeChild(link); window.URL.revokeObjectURL(blobUrl); toast.classList.add('hidden'); }).catch(err => { console.error(err); toast.classList.add('hidden'); alert("Gagal koneksi."); }); }
        function closeLightbox() { lightbox.classList.add('hidden'); lbImg.src = ""; lbVideo.src = ""; document.body.style.overflow = 'auto'; }
    </script>
</body>
</html>